<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Locatie Gevonden!</title>
    <style>
        body { background: #f4e4bc; font-family: 'Georgia', serif; text-align: center; padding: 20px; color: #5d2e0a; margin: 0; }
        .box { border: 3px double #5d2e0a; padding: 25px; display: inline-block; border-radius: 15px; background: rgba(255,255,255,0.2); max-width: 85%; margin-top: 20px; }
        .button-container { display: flex; flex-direction: column; gap: 12px; margin-top: 25px; align-items: center; }
        
        .btn-custom { width: 100%; max-width: 280px; padding: 18px 5px; border: 2px solid #555; border-radius: 12px; font-weight: bold; font-size: 13px; background: #000; color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.6); cursor: pointer; text-transform: uppercase; letter-spacing: 1px; text-decoration: none; display: block; -webkit-tap-highlight-color: transparent; }
        .btn-custom:active { background: #333; transform: translateY(2px); }
        .btn-custom:disabled { background: #888; cursor: not-allowed; opacity: 0.6; }

        .btn-main { background: #800020; border-color: #400010; }
        .hidden { display: none; }

        input[type="text"] { width: 100%; max-width: 260px; padding: 15px; border-radius: 10px; border: 2px solid #5d2e0a; margin-bottom: 15px; font-size: 16px; text-align: center; background: #fffdf5; }
        #timer-msg { color: #800020; font-weight: bold; margin-top: 10px; font-size: 14px; }
    </style>
</head>
<body>

    <div id="denied-msg">
        <h1>Toegang Geweigerd!</h1>
        <p>Je hebt deze locatie nog niet via de kaart geactiveerd of je bent niet dichtbij genoeg.</p>
        <div class="button-container">
            <a href="kaart.html" class="btn-custom">Terug naar de kaart</a>
        </div>
    </div>

    <div id="content" class="hidden">
        <div class="box">
            <h1>LOCATIE BEREIKT!</h1>
            <h2 id="loc-display" style="text-decoration: underline;">...</h2> 

            <div id="input-section">
                <p>Wat is het antwoord op het raadsel?</p>
                <input type="text" id="answer-input" placeholder="Typ hier je antwoord...">
                
                <div class="button-container">
                    <button id="submit-btn" onclick="sendAnswer()" class="btn-custom btn-main">Antwoord Controleren</button>
                    <div id="timer-msg"></div>
                    <a href="kaart.html" class="btn-custom" style="background: #444;">üó∫Ô∏è Terug naar kaart</a>
                </div>
            </div>

            <div id="success-section" class="hidden">
                <h2 style="color: green;">‚úì CORRECT!</h2>
                <p>Het gebied op de kaart is nu groen gemarkeerd.</p>
                <div class="button-container">
                    <a href="kaart.html" class="btn-custom">Volgende Locatie</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxvyXA8TKsdtMCXxbWf_RqEPEB_GE1U_qeiESiRkBCw-qgQSy_YpQCKig3MOAoHDEqS/exec'; // PLAK HIER JE WEB APP URL

        function checkAccess() {
            const locationName = sessionStorage.getItem('locationName');
            const sessionValid = sessionStorage.getItem('checkpointReached') === 'true';

            if (sessionValid && locationName) {
                document.getElementById('denied-msg').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');
                document.getElementById('loc-display').innerText = locationName;
            }
        }

        async function sendAnswer() {
            const btn = document.getElementById('submit-btn');
            const timerMsg = document.getElementById('timer-msg');
            const answer = document.getElementById('answer-input').value;
            const locationId = sessionStorage.getItem('locationName');
            const teamnaam = localStorage.getItem('teamnaam');

            if (!answer) return alert("Vul eerst een antwoord in.");

            btn.disabled = true;
            btn.innerText = "Controleren...";
            timerMsg.innerText = "";

            try {
                const response = await fetch(scriptURL, {
                    method: 'POST',
                    body: JSON.stringify({
                        teamnaam: teamnaam,
                        locatieId: locationId,
                        antwoord: answer
                    })
                });

                const result = await response.text();

                if (result === "CORRECT") {
                    document.getElementById('input-section').classList.add('hidden');
                    document.getElementById('success-section').classList.remove('hidden');
                } else if (result.startsWith("WAIT")) {
                    const minuten = result.split(":")[1];
                    timerMsg.innerText = `‚ùå Te snel! Wacht nog ${minuten} min.`;
                    btn.innerText = "Antwoord Controleren";
                    btn.disabled = false;
                } else {
                    alert("Helaas, dat antwoord is fout! Je team is nu 10 minuten geblokkeerd voor deze locatie.");
                    btn.innerText = "Antwoord Controleren";
                    btn.disabled = false;
                }
            } catch (error) {
                alert("Er ging iets mis met de verbinding.");
                btn.disabled = false;
                btn.innerText = "Antwoord Controleren";
            }
        }

        window.onload = checkAccess;
    </script>
</body>
</html>
