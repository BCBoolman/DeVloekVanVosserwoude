<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ondervraging - Vosserwoude</title>
    <style>
        body { margin: 0; padding: 20px; font-family: 'Georgia', serif; background: #222; color: #5d2e0a; display: flex; justify-content: center; }
        .paper-content { 
            background-color: #f4e4bc; 
            padding: 25px; 
            border-radius: 15px; 
            width: 100%; 
            max-width: 450px; 
            border: 3px double #5d2e0a; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            background-image: url('https://www.transparenttextures.com/patterns/parchment.png');
        }
        h2 { color: #800020; text-align: center; margin-top: 0; }
        #locatie-foto { width: 100%; border-radius: 8px; margin-bottom: 15px; border: 2px solid #5d2e0a; display: none; }
        .vraag-tekst { font-size: 18px; line-height: 1.6; margin-bottom: 20px; }
        input[type="text"] { 
            width: 100%; padding: 12px; margin-bottom: 20px; border-radius: 8px; 
            border: 1px solid #5d2e0a; box-sizing: border-box; font-size: 16px;
        }
        button { 
            width: 100%; padding: 15px; border-radius: 10px; border: none; 
            font-weight: bold; cursor: pointer; text-transform: uppercase;
        }
        .btn-check { background: #800020; color: white; }
        .btn-back { background: #555; color: white; margin-top: 10px; }
        
        #success-container { display: none; text-align: center; }
        .hint-box { 
            background: rgba(255,255,255,0.5); padding: 15px; 
            border-left: 5px solid #800020; font-style: italic; margin: 15px 0; text-align: left;
        }
    </style>
</head>
<body>

<div class="paper-content">
    <div id="vraag-container">
        <h2 id="locatie-titel">LADEN...</h2>
        <img id="locatie-foto" src="" alt="Locatie aanwijzing">
        <p class="vraag-tekst" id="vraag-veld">Geduld, de bewoner verschijnt zo...</p>
        
        <input type="text" id="antwoordInput" placeholder="Typ hier je antwoord...">
        <button class="btn-check" onclick="controleerAntwoord()">INDIENEN</button>
        <button class="btn-back" onclick="window.location.href='kaart.html'">KAART</button>
    </div>

    <div id="success-container">
        <h2>BEWIJS GELEVERD</h2>
        <p>Je hebt de bewoner met succes ondervraagd. In je logboek noteer je:</p>
        <div class="hint-box">
            <p id="hint-tekst"></p>
        </div>
        <button class="btn-check" onclick="window.location.href='kaart.html'">TERUG NAAR DE KAART</button>
    </div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzO11KEK7K1Xmd0AmAGzVKtnCwItUlMbRTfP6RHPfGCD2wJBQdGVzzGjbz8HOqDav_y/exec'; // VERVANG DIT DOOR JE EIGEN URL!
    const locatieId = sessionStorage.getItem('locationName');
    const teamnaam = localStorage.getItem('teamnaam');

    // 1. Haal vraag en foto op bij laden
    async function laadPagina() {
        if (!locatieId) { window.location.href = 'kaart.html'; return; }
        document.getElementById('locatie-titel').innerText = locatieId.toUpperCase();

        try {
            const res = await fetch(`${scriptURL}?getDetails=${encodeURIComponent(locatieId)}&teamnaam=${encodeURIComponent(teamnaam)}`);
            const data = await res.json();

            if (data.blokkade > 0) {
                alert(`Deze bewoner weigert nog te praten. Kom over ${data.blokkade} minuten terug.`);
                window.location.href = 'kaart.html';
            }

            document.getElementById('vraag-veld').innerText = data.vraag;
            if (data.foto) {
                const img = document.getElementById('locatie-foto');
                img.src = data.foto;
                img.style.display = 'block';
            }
        } catch (e) {
            document.getElementById('vraag-veld').innerText = "Fout bij laden van de bewoner.";
        }
    }

    // 2. Antwoord controleren
    async function controleerAntwoord() {
        const antwoord = document.getElementById('antwoordInput').value;
        if (!antwoord) return alert("Vul een antwoord in!");

        const btn = document.querySelector('.btn-check');
        btn.innerText = "CONTROLE...";
        btn.disabled = true;

        try {
            const res = await fetch(scriptURL, {
                method: 'POST',
                body: JSON.stringify({
                    teamnaam: teamnaam,
                    locatieId: locatieId,
                    antwoord: antwoord
                })
            });
            const result = await res.text();

            if (result.startsWith("CORRECT")) {
                const hint = result.split("|")[1];
                document.getElementById('vraag-container').style.display = 'none';
                document.getElementById('success-container').style.display = 'block';
                document.getElementById('hint-tekst').innerText = hint;
            } else if (result === "WRONG") {
                alert("Dat is niet het juiste antwoord! De bewoner is beledigd en praat de komende 10 minuten niet meer met je.");
                window.location.href = 'kaart.html';
            } else if (result.startsWith("WAIT")) {
                alert("Je bent nog geblokkeerd op deze locatie.");
                window.location.href = 'kaart.html';
            }
        } catch (e) {
            alert("Er ging iets mis bij het verzenden.");
            btn.disabled = false;
            btn.innerText = "INDIENEN";
        }
    }

    laadPagina();
</script>

</body>
</html>
